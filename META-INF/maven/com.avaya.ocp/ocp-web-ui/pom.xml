<?xml version="1.0"?>
<project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
         xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	
	
    <parent>
        <groupId>com.avaya.ucam</groupId>
        <artifactId>ucam-parent</artifactId>
        <version>10.0.6-SNAPSHOT</version>
    </parent>
	
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.avaya.ocp</groupId>
    <artifactId>ocp-web-ui</artifactId>
    <version>10.0.6</version>
    <packaging>war</packaging>
    <name>Customer Web UI</name>
    <description>The customer-facing user interface for the Omnichannel project</description>

    <!-- Set Sonar to analyse JavaScript -->
    <properties>
        <product.release>3.5.0.0</product.release>

        <!-- Sonar properties -->
        <sonar.projectKey>${project.groupId}:${project.artifactId}:3.2</sonar.projectKey>
        <sonar.projectName>${project.artifactId}</sonar.projectName>
        <sonar.host.url>http://sonar.forge.avaya.com:9000</sonar.host.url>
        <!-- fix Sonar -->
        <sonar.branch>feature/OCPROVIDER-1042</sonar.branch>
        <sonar.login>87f1229a07458dc6928cd3fe4d55227bd4403e23</sonar.login>
        <sonar.language>js</sonar.language>
        <sonar.sources>src/main/webapp/js</sonar.sources>
		
        <!-- See profile 'skipSonarIfBranchNotDevelop' below -->
        <sonar.skip>true</sonar.skip>

        <bamboo.plan.key>OCPROVIDER-WEBUIJS</bamboo.plan.key>

        <!-- We have no control over the code in this folder, so ignore them -->
        <sonar.exclusions>src/main/webapp/js/libs/**/*</sonar.exclusions>
    </properties>

	
    <profiles>
        <profile>
            <id>skipSonarIfBranchNotDevelop</id>
            <activation>
                <property>
                    <name>gitBranch</name>
                    <value>develop</value>
                </property>
            </activation>

            <properties>
                <sonar.skip>false</sonar.skip>
            </properties>
        </profile>
    </profiles>

    <build>
        <resources>
            <resource>
                <!-- JS files aren't supported by maven out-of-the-box -->
                <directory>src/main/webapp/js</directory>
                <filtering>true</filtering>
            </resource>
            <resource>
                <directory>src/dist/dist/js</directory>
                <filtering>true</filtering>
            </resource>
        </resources>
        <plugins>


            <plugin>
                <groupId>com.cj.jshintmojo</groupId>
                <artifactId>jshint-maven-plugin</artifactId>
                <executions>
                    <execution>
                        <goals>
                            <goal>lint</goal>
                        </goals>
                    </execution>
                </executions>
                <configuration>
                    <version>2.4.3</version>
                    <configFile>.jshintrc</configFile>
                    <directories>
                        <directory>src/main/webapp/js</directory>
                    </directories>
                    <excludes>
                        <exclude>src/main/webapp/js/libs</exclude>
                        <exclude>src/main/webapp/js/webChatUI.js</exclude>
                    </excludes>
                    <reporter>jslint</reporter>
                    <reportFile>target/reports/jshint_reports.xml</reportFile>
                    <failOnError>true</failOnError>
                </configuration>
            </plugin>
            
            <plugin>
                <groupId>com.github.timurstrekalov</groupId>
                <artifactId>saga-maven-plugin</artifactId>
                <version>1.5.5</version>
                <executions>
                  <execution>
                    <goals>
                      <goal>coverage</goal>
                    </goals>
                  </execution>
                </executions>
                <configuration>
                  <baseDir>http://localhost:${jasmine.serverPort}</baseDir>
                  <outputDir>target/coverage</outputDir>
                  <reportFormats>HTML,PDF</reportFormats>
                  <noInstrumentPatterns>
                    <pattern>.*/spec/.*</pattern> <!-- Don't instrument specs -->
                    <pattern>.+/libs/.*</pattern> <!-- or third-party libraries -->
                    <pattern>.+/webjars/jasmine/.*</pattern> <!-- no idea why these two were being instrumented! -->
                    <pattern>.+/classpath/*/.*</pattern>
                    
                    <!-- The following are low-level or UI-related things that we shouldn't be testing -->
                    <pattern>.+/webChatUI\.js</pattern>
                    <pattern>.+/links\.js</pattern>
                    <pattern>.+/contextStoreUI\.js</pattern>
                    <pattern>.+/chatConfigPanel\.js</pattern>
                    <pattern>.+/coBrowseUI\.js</pattern>
                    <pattern>.+/coBrowse\.js</pattern>
                  </noInstrumentPatterns>
                </configuration>
            </plugin>

            <plugin>
                <!-- http://dkirrane.github.io/ggitflow-maven-plugin -->
                <groupId>com.avaya.maven.plugins</groupId>
                <artifactId>ggitflow-maven-plugin</artifactId>
                <version>3.0</version>
                <configuration>
                    <msgPrefix>[ggitflow-maven-plugin]</msgPrefix>
                </configuration>
            </plugin>
                        
            <plugin>
                <groupId>com.github.searls</groupId>
                <artifactId>jasmine-maven-plugin</artifactId>
                <version>2.2</version>
                <executions>
                    <execution>
                        <goals>
                            <goal>test</goal>
                        </goals>
                    </execution>
                </executions>
                <configuration>
                    <debug>true</debug>
                    <jsSrcDir>src/main/webapp/js</jsSrcDir>
                    <sourceIncludes>
                        <include>avayaGlobal.js</include>
                        <include>links.js</include>
                        <include>chatConfigPanel.js></include>
                        <include>webChat.js</include>
                        <include>webChatLogon.js</include>
                        <include>webChatSocket.js</include>
                        <include>webChatConfig.js</include>
                        <include>webChatUI.js</include>
                        <include>estimatedWaitTime.js</include>
                        <include>customerJourneyCommon.js</include>
                        <include>oceanaCoreData.js</include>
                    </sourceIncludes>
                    <jsTestSrcDir>src/test/javascript/spec</jsTestSrcDir>
                    <preloadSources>
                        <source>src/main/webapp/js/libs/jquery-3.3.1.min.js</source>
                        <source>src/main/webapp/js/libs/xmlToJSON.js</source>
                        <source>src/main/webapp/js/libs/AvayaClientServices.min.js</source>
                        <source>src/main/webapp/cobrowse-oceana/js/libs/LAB.min.js</source>
                        <source>src/main/webapp/cobrowse-oceana/js/coBrowse.js</source>
                        <source>src/main/webapp/cobrowse-oceana/js/coBrowseUI.js</source>
                    </preloadSources>
                    <keepServerAlive>true</keepServerAlive>
                </configuration>
            </plugin>

        </plugins>

        <!-- actually run Sonar -->
        <pluginManagement>
            <plugins>
                <plugin>
                    <groupId>org.codehaus.mojo</groupId>
                    <artifactId>sonar-maven-plugin</artifactId>
                    <version>LATEST</version>
                </plugin>
            </plugins>
        </pluginManagement>
    </build>

    <repositories>
        <repository>
            <id>aoec-maven</id>
            <url>https://nexus-ott.forge.avaya.com/repository/aoec-maven/</url>
            <snapshots>
                <enabled>true</enabled>
            </snapshots>
        </repository>
    </repositories>
    <pluginRepositories>
        <pluginRepository>
            <id>aoec-maven</id>
            <url>https://nexus-ott.forge.avaya.com/repository/aoec-maven/</url>
        </pluginRepository>
    </pluginRepositories>
</project>
